'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _isomorphicFetch=require('isomorphic-fetch');var _isomorphicFetch2=_interopRequireDefault(_isomorphicFetch);var _utils=require('../utils');var _httpError=require('../http-error');var _httpError2=_interopRequireDefault(_httpError);var _composeMiddleware=require('./compose-middleware');var _composeMiddleware2=_interopRequireDefault(_composeMiddleware);var _middleware=require('./middleware');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function http(endpoint){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref$onSuccess=_ref.onSuccess,onSuccess=_ref$onSuccess===undefined?_utils.identity:_ref$onSuccess,_ref$onFailure=_ref.onFailure,onFailure=_ref$onFailure===undefined?_utils.identity:_ref$onFailure,_ref$camelizeResponse=_ref.camelizeResponse,camelizeResponse=_ref$camelizeResponse===undefined?true:_ref$camelizeResponse,_ref$before=_ref.before,before=_ref$before===undefined?_utils.noop:_ref$before,successDataPath=_ref.successDataPath,_ref$failureDataPath=_ref.failureDataPath,failureDataPath=_ref$failureDataPath===undefined?'errors':_ref$failureDataPath,options=_objectWithoutProperties(_ref,['onSuccess','onFailure','camelizeResponse','before','successDataPath','failureDataPath']);return(0,_composeMiddleware2.default)(before,_middleware.setDefaults,_middleware.setAuthHeaders,_middleware.addRootToEndpoint,_middleware.addQueryToEndpoint,_middleware.serializeBody,_middleware.includeCSRFToken,_middleware.filterFetchOptions)(_extends({endpoint:endpoint},options)).then(function(_ref2){var endpoint=_ref2.endpoint,config=_objectWithoutProperties(_ref2,['endpoint']);return(0,_isomorphicFetch2.default)(endpoint,config)}).then(function(res){return res.json().then(function(json){var data=camelizeResponse?(0,_utils.camelizeKeys)(json):json;if(res.ok)return(0,_utils.getDataAtPath)(data,successDataPath);var errors=(0,_utils.getDataAtPath)(data,failureDataPath);throw new _httpError2.default(res.status,res.statusText,data,errors)})}).then(onSuccess).catch(function(e){throw onFailure(e)})}exports.default=http;